/*
* Copyright 2017 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

!function(a,b){function e(){var b=!0;return a(".edit-menu-item-title, .edit-menu-item-url").not(".localized").each(function(){var c=a(this);if(""===c.val()){var d=c.closest(".menu-item");return!(!d.isColumn()&&!d.isRow())||(d.hasClass("menu-item-edit-inactive")&&(d.find(".menu-item-settings .nav-tabs li:first a").tab("show"),d.find(".item-edit").click()),c.addClass("invalid").one("focus",function(){a(this).removeClass("invalid")}),b=!1,!1)}}),b}function f(){var c=function(){var b=1;a("#menu-to-edit > .menu-item").each(function(){var c=a(this),d=c.menuItemDepth(),e=0===d?d:parseInt(d-1,10),f=c.prevAll(".menu-item-depth-"+e).first(),g=c.hasClass("menu-item-depth-0")?0:parseInt(f.attr("data-menuItemId"))||0,h=c.find(".edit-menu-item-entityId").val();c.isPicture()&&(h=c.find("#EntityId").val());var i=c.find("#SelectedCustomerRoleIds").data("kendoMultiSelect").value().map(Number),j={id:parseInt(c.attr("data-menuItemId"))||0,type:parseInt(c.find(".item-type").attr("data-itemType"))||0,title:c.find(".edit-menu-item-title").val()||"",url:c.find(".edit-menu-item-url").val()||"",openInNewWindow:c.find(".edit-menu-item-openinnewwindow").is(":checked"),cssClass:c.find(".edit-menu-item-classes").val()||"",maximumNumberOfEntities:parseInt(c.find(".edit-menu-item-maximum-number-of-entities").val())||0,numberOfBoxesPerRow:parseInt(c.find(".edit-menu-item-number-of-boxes-per-row").val())||0,imageSize:parseInt(c.find(".edit-menu-item-image-size").val())||0,entityId:parseInt(h)||0,width:parseFloat(c.find(".edit-menu-item-width").val())||0,catalogTemplate:parseInt(c.find(".edit-menu-item-template").val())||0,parentMenuItemId:g,displayOrder:b,selectedCustomerRoleIds:i};for(var k in j)if(j.hasOwnProperty(k))if("selectedCustomerRoleIds"==k)for(var l=0;l<j[k].length;l++)a("#mega-menu-edit-tabs").append('<input type="hidden" name="Items['+(b-1)+"]."+k+"["+l+']" value="'+j[k][l]+'" />');else a("#mega-menu-edit-tabs").append('<input type="hidden" name="Items['+(b-1)+"]."+k+'" value="'+j[k]+'" />');c.find(".edit-menu-item-title.localized, .edit-menu-item-url.localized, .edit-menu-item-language-id").each(function(){var c=a(this),d=c.attr("name"),e=c.val();a("#mega-menu-edit-tabs").append('<input type="hidden" name="Items['+(b-1)+"]."+d+'" value="'+e+'" />')}),b++})};a(".save-settings-button").on("click",function(d){var f=e();return f?(b.isLoaded&&c(),void a("#mega-menu-edit-tabs").append('<input type="hidden" name="UpdateMenuItems" value="'+b.isLoaded+'" />')):(d.preventDefault(),void d.stopPropagation())})}function g(b){a(b).find(".checkbox:checked").click()}function h(){a("#SubmitCustomLink").on("click",function(c){c.preventDefault();var d=!0,e=a(this).closest(".add-menu-item-form"),f=e.find("#CustomLinkTitle"),g=e.find("#CustomLinkUrl"),h=f.val(),i=g.val();""===h&&(f.addClass("invalid"),d=!1),""===i&&(g.addClass("invalid"),d=!1),d&&(b.addItemToMenu(e,{id:0,title:h,url:i,Type:200,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},b.addMenuItemToBottom),f.val(""),g.val(""))}),a("#CustomLinkTitle, #CustomLinkUrl").on("focus",function(){a(this).removeClass("invalid"),a(this).closest(".add-menu-item-form").find(".error-message").remove()})}function i(){a("#SubmitPageLink").on("click",function(c){c.preventDefault();var d=a(this).closest("#add-page-link-form"),e=d.find('input[type="checkbox"]:checked');0!==e.length&&(e.each(function(){b.addItemToMenu(d,{id:0,title:a(this).next("span").text(),url:"",Type:a(this).val(),OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},b.addMenuItemToBottom)}),g("#add-page-link-form"))})}function j(b,d,e,f,g){var h={},i=a(b),j="Name";"topics"===g&&(j="Title (System Name)");var k=i.kendoGrid({dataSource:{type:"json",transport:{read:{type:"POST",url:i.attr("data-readUrl"),dataType:"json",contentType:"application/json"},parameterMap:function(a,b){return"read"!==b?a:JSON.stringify(a)}},serverFiltering:!0,serverPaging:!0,pageSize:8,schema:{data:"Data",total:"Total",errors:"Errors",model:{id:"Id",fields:{Name:{editable:!1,type:"string"}}}}},scrollable:{virtual:!0},autoBind:!1,dataBound:function(a){if(a.sender.virtualScrollable._fetching)for(var b=this.dataSource.view(),c=0;c<b.length;c++)h[b[c].Id]&&this.tbody.find("tr[data-itemId='"+b[c].Id+"']").addClass("k-state-selected").find(".checkbox").attr("checked","checked")},toolbar:kendo.template(a(f).html()),columns:[j],rowTemplate:kendo.template(a(e).html())}).data("kendoGrid");k.table.on("click",".checkbox",function(){var b=this.checked,c=a(this).closest("tr"),d=k.dataItem(c);h[d.id]=b,b?c.addClass("k-state-selected"):c.removeClass("k-state-selected")});var l,m;m="oninput"in document.createElement("input")?"input":"keyup",a(d).on(m,function(){var b=a(this).val();l&&clearTimeout(l),l=setTimeout(function(){h=[];var a={};b&&(a="#topics-autocomplete"===d?{logic:"or",filters:[{field:"Title",operator:"contains",value:b},{field:"SystemName",operator:"contains",value:b}]}:{field:"Name",operator:"contains",value:b}),k.dataSource.filter(a)},500)}).on("keydown",function(a){13===a.which&&(a.preventDefault(),a.stopPropagation())}).attr("autocomplete","off"),c[g]=function(){var a=[];for(var b in h)h.hasOwnProperty(b)&&h[b]&&a.push(b);return a}}function k(a){var b=a.val(),c="0"===b,d="5"===b,e=a.closest(".menu-item-settings");e.find(".field-image-size").toggle(d),e.find(".field-number-of-boxes-per-row").toggle(d),e.find(".field-maximum-number-of-entities").toggle(!c);var f=e.find(".field-maximum-number-of-entities > label > span"),g=f.attr("data-subCategories"),h=f.attr("data-entities");if(g&&h){var i=d?g:h;f.text(i)}}function l(b){b.each(function(){var b=a(this);a.data(this,"current",b.val()),b.off("change").on("change",function(){var c=b.closest(".menu-item"),d=c.menuItemDepth(),e=c.prevAll(".menu-item-depth-"+(d-1)).first(),f=c.childMenuItems();return"0"!==b.val()&&(f.length>0||e.length>0&&!e.isColumn())?(b.val(a.data(this,"current")),a(".automatic-orphaning").show(),void setTimeout(function(){a(".automatic-orphaning").fadeOut()},4e3)):(a.data(this,"current",b.val()),void k(b))}),k(b)})}function m(){var e=!1;l(a(".edit-menu-item-template")),a('input[name="category-type"]').on("change",function(){var b=a("#category-all-item").is(":checked");b?a("#categories-grid").fadeOut():a("#categories-grid").fadeIn(),e||(a("#categories-grid").data("kendoGrid").dataSource.read(),e=!0)}),a("#SubmitCategoryLink").on("click",function(e){e.preventDefault();var f=a(this).closest("#add-category-link-form"),h=a("#category-all-item"),i=h.is(":checked"),j=h.val();if(i)return void b.addItemToMenu(f,{id:0,title:d.attr("data-menuItemProducts"),url:"",Type:j,CatalogTemplate:5,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},b.addMenuItemToBottom,function(){l(a("#menu-to-edit > li:last-child .edit-menu-item-template"))});for(var k=c.categories(),m=0;m<k.length;m++){var n=parseInt(k[m]);isNaN(n)||b.addItemToMenu(f,{id:0,title:"",url:"",Type:j,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:n,ParentMenuItemId:0},b.addMenuItemToBottom,function(){l(a("#menu-to-edit > li:last-child .edit-menu-item-template"))})}g("#categories-grid")})}function n(){var e=!1;l(a(".edit-menu-item-template")),a('input[name="manufacturer-type"]').on("change",function(){var b=a("#manufacturer-all-item").is(":checked");b?a("#manufacturers-grid").fadeOut():a("#manufacturers-grid").fadeIn(),e||(a("#manufacturers-grid").data("kendoGrid").dataSource.read(),e=!0)}),a("#SubmitManufacturerLink").on("click",function(e){e.preventDefault();var f=a(this).closest("#add-manufacturer-link-form"),h=a("#manufacturer-all-item"),i=h.is(":checked"),j=h.val();if(i)return void b.addItemToMenu(f,{id:0,title:d.attr("data-menuItemManufacturers"),url:"",Type:j,CatalogTemplate:5,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},b.addMenuItemToBottom,function(){l(a("#menu-to-edit > li:last-child .edit-menu-item-template"))});for(var k=c.manufacturers(),m=0;m<k.length;m++){var n=parseInt(k[m]);isNaN(n)||b.addItemToMenu(f,{id:0,title:"",url:"",Type:j,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:n,ParentMenuItemId:0},b.addMenuItemToBottom,function(){l(a("#menu-to-edit > li:last-child .edit-menu-item-template"))})}g("#manufacturers-grid")})}function o(){var e=!1;l(a(".edit-menu-item-template")),a('input[name="vendor-type"]').on("change",function(){var b=a("#vendor-all-item").is(":checked");b?a("#vendors-grid").fadeOut():a("#vendors-grid").fadeIn(),e||(a("#vendors-grid").data("kendoGrid").dataSource.read(),e=!0)}),a("#SubmitVendorLink").on("click",function(e){e.preventDefault();var f=a(this).closest("#add-vendor-link-form"),h=a("#vendor-all-item"),i=h.is(":checked"),j=h.val();if(i)return void b.addItemToMenu(f,{id:0,title:d.attr("data-menuItemVendors"),url:"",Type:j,CatalogTemplate:5,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},b.addMenuItemToBottom,function(){l(a("#menu-to-edit > li:last-child .edit-menu-item-template"))});for(var k=c.vendors(),m=0;m<k.length;m++){var n=parseInt(k[m]);isNaN(n)||b.addItemToMenu(f,{id:0,title:"",url:"",Type:j,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:n,ParentMenuItemId:0},b.addMenuItemToBottom,function(){l(a("#menu-to-edit > li:last-child .edit-menu-item-template"))})}g("#vendors-grid")})}function p(){var e=!1;a('input[name="topic-type"]').on("change",function(){var b=a("#topic-all-item").is(":checked");b?a("#topics-grid").fadeOut():a("#topics-grid").fadeIn(),e||(a("#topics-grid").data("kendoGrid").dataSource.read(),e=!0)}),a("#SubmitTopicLink").on("click",function(e){e.preventDefault();var f=a(this).closest("#add-topic-link-form"),h=a("#topic-all-item"),i=h.is(":checked"),j=h.val();if(i)return void b.addItemToMenu(f,{id:0,title:d.attr("data-menuItemTopics"),url:"",Type:j,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},b.addMenuItemToBottom);for(var k=c.topics(),l=0;l<k.length;l++){var m=parseInt(k[l]);isNaN(m)||b.addItemToMenu(f,{id:0,title:"",url:"",Type:j,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:m,ParentMenuItemId:0},b.addMenuItemToBottom)}g("#topics-grid")})}function q(){var e=!1;a('input[name="product-tags-type"]').on("change",function(){var b=a("#product-tags-all-item").is(":checked");b?a("#product-tags-grid").fadeOut():a("#product-tags-grid").fadeIn(),e||(a("#product-tags-grid").data("kendoGrid").dataSource.read(),e=!0)}),a("#SubmitProductTagsLink").on("click",function(e){e.preventDefault();var f=a(this).closest("#add-product-tag-link-form"),h=a("#product-tags-all-item"),i=h.is(":checked"),j=h.val();if(i)return void b.addItemToMenu(f,{id:0,title:d.attr("data-menuItemProductTags"),url:"",Type:j,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},b.addMenuItemToBottom);for(var k=c.productTags(),l=0;l<k.length;l++){var m=parseInt(k[l]);isNaN(m)||b.addItemToMenu(f,{id:0,title:"",url:"",Type:j,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:m,ParentMenuItemId:0},b.addMenuItemToBottom)}g("#product-tags-grid")})}function r(){a("#SubmitLayout").on("click",function(c){c.preventDefault();var d=a(this).closest(".add-menu-item-form"),e=d.find("#LayoutTitle"),f=d.find("#LayoutType"),g=e.val(),h=f.val();return""===g?void e.addClass("invalid"):(b.addItemToMenu(d,{id:0,title:g,url:"",Type:h,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:0},b.addMenuItemToBottom),void e.val(""))}),a("#LayoutTitle").on("focus",function(){a(this).removeClass("invalid"),a(this).closest(".add-menu-item-form").find(".error-message").remove()})}function s(){a("#SubmitColumn").on("click",function(c){c.preventDefault();var d=a(this).closest(".add-menu-item-form"),e=a("#ParentColumnsLayout").val();b.addItemToMenu(d,{id:0,title:"",url:"",Type:155,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:e},b.addMenuItemToElement)})}function t(){a("#SubmitRow").on("click",function(c){c.preventDefault();var d=a(this).closest(".add-menu-item-form"),e=a("#ParentRowsLayout").val();b.addItemToMenu(d,{id:0,title:"",url:"",Type:156,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:e},b.addMenuItemToElement)})}function u(){a("#SubmitPicture").on("click",function(c){c.preventDefault();var d=a(this).closest(".add-menu-item-form"),e=a("#ParentColumn").val();b.addItemToMenu(d,{id:0,title:"",url:"",Type:160,OpenInNewWindow:!1,DisplayOrder:0,MaximumNumberOfEntities:0,ImageSize:0,EntityId:0,ParentMenuItemId:e},b.addMenuItemToElement)})}var d,c={};a(document).ready(function(){a("body").addClass("nav-menus-php"),d=a("#mega-menu-info"),bindBootstrapTabSelectEvent("mega-menu-edit-tabs"),h(),i(),j("#categories-grid","#categories-autocomplete","#categoriesRowTemplate","#categoriesGridToolbarTemplate","categories"),m(),j("#topics-grid","#topics-autocomplete","#topicsRowTemplate","#topicsGridToolbarTemplate","topics"),p(),j("#manufacturers-grid","#manufacturers-autocomplete","#manufacturersRowTemplate","#manufacturersGridToolbarTemplate","manufacturers"),n(),j("#vendors-grid","#vendors-autocomplete","#vendorsRowTemplate","#vendorsGridToolbarTemplate","vendors"),o(),j("#product-tags-grid","#product-tags-autocomplete","#productTagsRowTemplate","#productTagsGridToolbarTemplate","productTags"),q(),r(),s(),t(),u(),f()})}(jQuery,megaMenu);