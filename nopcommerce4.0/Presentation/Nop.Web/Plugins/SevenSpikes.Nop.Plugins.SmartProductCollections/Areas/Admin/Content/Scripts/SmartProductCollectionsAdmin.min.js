!function (a) { function g() { a("html, body").animate({ scrollTop: a(".visualized-tabs-wrapper").offset().top - 60 }, 700) } function h() { var b = parseInt(a("#NumberOfProductsPerItem").val()) + 1; a("head").append("<style> .products-grid .sortable:nth-child(n+" + b + ") { opacity: 0.2; } </style>") } var c, b = "data-itemId", d = function () { var a = [], b = !0; return { isSaveToPop: function (a) { return void 0 === a ? b : (b = a, void this.next()) }, push: function (b) { a.push(b), this.next() }, next: function () { if (b) { var c = a.shift(); "function" == typeof c && c() } } } }, e = new d, f = new d, i = function () { var d = a("#tabstrip"); 0 !== d.length && (c = d.kendoTabStrip({ animation: { open: { effects: "fadeIn" } }, select: g }).data("kendoTabStrip"), c.tabGroup.children().length > 0 && c.activateTab("li:first"), c.disable(a("#add-new-item-from-tabstrip-button")), a("#tabstrip ul.k-tabstrip-items").kendoSortable({ filter: "li.k-item:not(#add-new-item-from-tabstrip-button)", axis: "x", container: "ul.k-tabstrip-items", hint: function (b) { return a("<div id='sortable-tabs-hint' class='k-widget k-header k-tabstrip'><ul class='k-tabstrip-items k-reset'><li class='k-item k-state-active k-tab-on-top'>" + b.html() + "</li></ul></div>") }, start: function (a) { c.activateTab(a.item) }, change: function (d) { var f = c.tabGroup.children().eq(d.newIndex); d.oldIndex < d.newIndex ? c.insertAfter(d.item, f) : c.insertBefore(d.item, f), e.push(function () { var c = []; a("#tabstrip li.k-item[" + b + "]").each(function () { c.push(a(this).attr(b)) }); var d = a(".categories-sortable-list .sortable.active"), f = addAntiForgeryToken(); f.groupId = parseInt(a("#Id").val()) || parseInt(d.attr("data-productgroupid")) || 0, f.ids = c, e.isSaveToPop(!1), a.ajax({ url: a(".visualized-tabs-wrapper").attr("data-reorderGroupItemsUrl"), type: "POST", data: f }).fail(function (a) { }).always(function () { e.isSaveToPop(!0) }) }) } })) }, j = function (c) { var d = a("#tabstrip li[" + b + '="' + c + '"]').attr("aria-controls"), e = a("#" + d); e.find(".found-products-grid .loader").show(); var f = addAntiForgeryToken(); f.id = c, a.ajax({ url: a(".visualized-tabs-wrapper").attr("data-getProductsForSourceTypeUrl"), type: "POST", data: f }).done(function (b) { e.find(".found-products-grid .products-grid").html(b), "70" === e.find("select.itemSourceType").val() && a(".visualized-tabs-wrapper").trigger("customListProductsLoaded", { tabContent: e }) }).always(function () { e.find(".found-products-grid .loader").hide(), a(".products-vary-by-acl-message").removeClass("hidden") }) }, k = function (b) { var c = a(".visualized-tabs-wrapper"), d = b.closest(".tab-content.k-content"), e = parseInt(b.val()), f = addAntiForgeryToken(), g = parseInt(d.find(".group-item-id").val()) || 0, h = a('#tabstrip .tabs-anchors li[aria-controls="' + d.attr("id") + '"]'); if (f.itemId = g, f.sourceType = e, d.find(".custom-item-content, .found-products-grid .products-grid, .custom-list-add-products").empty(), 0 === e) { var i = c.attr("data-defaultItemTitle") || "<No Title>"; return void h.find(".k-link").text(i) } a.ajax({ url: c.attr("data-sourceTypeChangeUrl"), type: "POST", data: f }).done(function (b) { var f = d.find(".custom-item-content"); f.html(b), d.find(".custom-list-add-products").empty(); var i = f.find('.group-item-title[name="Title"]').val(); i && h.find(".k-link").text(i), 10 !== e && 20 !== e && 30 !== e && 35 !== e && 70 !== e || j(g), c.on("change", ".itemEntityId, .itemSortMethod", function () { l(a(this)) }) }) }, l = function (b) { var c = a(".visualized-tabs-wrapper"), d = b.closest(".tab-content.k-content"), e = a('#tabstrip .tabs-anchors li[aria-controls="' + d.attr("id") + '"]'), f = parseInt(d.find(".group-item-id").val()) || 0, g = parseInt(d.find("select.itemEntityId").val()) || 0, h = parseInt(d.find("select.itemSortMethod").val()) || 0; if (0 === g) return void d.find(".found-products-grid .products-grid").empty(); var i = addAntiForgeryToken(); i.Id = f, i.EntityId = g, i.SortMethod = h, a.ajax({ url: c.attr("data-entityOrSortMethodChangeUrl"), type: "POST", data: i }).done(function (a) { var b = a.title || c.attr("data-defaultItemTitle") || "<No Title>"; e.find(".k-link").text(b), a.title && d.find('[name="Title"]').val(a.title), j(f) }) }, m = function (b) { var c = b.closest(".tab-content.k-content"), d = b.closest("form"), e = d.attr("action"), f = d.attr("method"), g = parseInt(c.find(".group-item-id").val()) || 0; if (!isNaN(g) && 0 !== g) { var h = d.serialize(); h += "&save=save", a.ajax({ url: e, type: f, data: h }).done(function () { var a = d.find(".homepage-products-mappings-grid").data("kendoGrid"); a.dataSource.read(), j(g) }) } }, n = function (a) { var b = a.closest(".tab-content.k-content"); b.find('.found-products-grid .item-box[data-productId="' + a.val() + '"] .remove-button').click() }, o = function () { var d = a(".visualized-tabs-wrapper"); i(), a(".add-new-group-item-button, #add-new-item-from-tabstrip-button").off("click"), d.off("change", ".itemSourceType"), d.off("click", ".remove-item"), d.off("change", ".group-item-title"), d.off("change", ".group-item-active-input"), d.off("change", ".itemEntityId, .itemSortMethod"), d.off("click", '.custom-list-add-products .homepage-products-mappings-grid input[type="checkbox"]'), d.off("click", ".found-products-grid .item-box .remove-button"), d.off("customListProductsLoaded"), a("#Store").off("change"), a(".add-new-group-item-button, #add-new-item-from-tabstrip-button").on("click", function (e) { e.preventDefault(); var f = a(".categories-sortable-list .sortable.active"), h = addAntiForgeryToken(); h.groupId = parseInt(a("#Id").val()) || parseInt(f.attr("data-productgroupid")) || 0, h.categoryId = parseInt(f.attr("data-categoryid")) || 0, a.ajax({ url: d.attr("data-createGroupItemUrl"), type: "POST", data: h }).done(function (e) { var f = a(e), h = f.find(".group-item-id"), i = h.val(); if (void 0 != i) { a(".add-new-group-item-button").addClass("hidden"), a(".no-product-items-available").addClass("hidden"); var j = a("#add-new-item-from-tabstrip-button"), m = a(".add-new-item-tabstrip-content"); a("#tabstrip").show().find(m).before(f), c.insertBefore({ text: h.attr("data-defaultTitle") }, j); var n = j.prev(); n.attr(b, i), c.activateTab(n), c.tabGroup.children().length > 2 && a(".drag-and-drop-items-info").removeClass("hidden"), g(), d.on("change", ".itemEntityId, .itemSortMethod", function () { l(a(this)) }), d.on("change", ".itemSourceType", function () { k(a(this)) }) } }) }), d.on("click", ".remove-item", function (e) { e.preventDefault(); var f = a(this), g = parseInt(f.attr(b)); if (!isNaN(g) && 0 !== g) { var h = confirm("Are you sure ?"); if (h !== !1) { var i = addAntiForgeryToken(); i.id = g, a.ajax({ url: d.attr("data-deleteGroupItemUrl"), type: "POST", data: i }).done(function () { var d = a("#tabstrip li").filter("[" + b + '="' + g + '"]'); c.remove(d), 1 === c.tabGroup.children().length ? (a("#tabstrip").hide(), a(".add-new-group-item-button").removeClass("hidden"), a(".no-product-items-available").removeClass("hidden"), a(".products-vary-by-acl-message").addClass("hidden")) : d.is(".k-state-active") && c.activateTab("li:first"), c.tabGroup.children().length <= 2 && a(".drag-and-drop-items-info").addClass("hidden") }) } } }), d.on("change", ".group-item-title", function () { var c = a(this), e = c.val(), f = c.closest(".tab-content.k-content"), g = a('#tabstrip .tabs-anchors li[aria-controls="' + f.attr("id") + '"]'), h = f.find(".group-item-title"), i = f.find('input[name$="LanguageId"]'), j = addAntiForgeryToken(); j.Id = parseInt(g.attr(b)) || 0, j.Title = h.filter('[name="Title"]').val(), h.each(function () { var b = a(this); j[b.attr("name")] = b.val() }), i.each(function () { var b = a(this); j[b.attr("name")] = b.val() }), "" !== e && g.find(".k-link").text(e), a.ajax({ url: d.attr("data-titleChangeUrl"), type: "POST", data: j }).done(function (a) { h.filter('[name="Title"]').val(a.title), g.find(".k-link").text(a.title) }) }), d.on("change", ".group-item-active-input", function () { var c = a(this), e = addAntiForgeryToken(); e.Id = parseInt(c.attr(b)) || 0, e.Active = c.is(":checked"), a.ajax({ url: d.attr("data-activeChangeUrl"), type: "POST", data: e }) }), d.on("change", ".itemEntityId, .itemSortMethod", function () { l(a(this)) }), d.on("change", ".itemSourceType", function () { k(a(this)) }), d.on("click", '.custom-list-add-products .homepage-products-mappings-grid input[type="checkbox"]', function () { var b = a(this); b.is(":checked") ? m(b) : n(b) }), d.on("click", ".found-products-grid .item-box .remove-button", function () { var b = a(this), c = b.closest(".tab-content.k-content"), e = parseInt(c.find(".group-item-id").val()) || 0, f = b.closest(".item-box"), g = parseInt(f.attr("data-productId")) || 0; if (!isNaN(e) && 0 !== e && !isNaN(g) && 0 !== g) { var h = addAntiForgeryToken(); h.id = e, h.productId = g, a.ajax({ url: d.attr("data-deleteProductFromCustomListUrl"), type: "POST", data: h }).done(function () { f.remove(); var a = c.find(".homepage-products-mappings-grid").data("kendoGrid"); a.dataSource.read(), j(e) }) } }), d.on("customListProductsLoaded", function (b, c) { var e = c.tabContent; if (void 0 != e && 0 !== e.length && "70" === e.find("select.itemSourceType").val()) { var g = e.find(".found-products-grid .products-grid"); g.hasClass("sortable-grid") && g.kendoSortable("destroy"), g.addClass("sortable-grid"); var h = g.children(".item-box"); h.addClass("sortable removable"), h.prepend('<div class="remove-button">remove</div>'), e.find(".drag-and-drop-products-info").toggleClass("hidden", h.length < 2), g.kendoSortable({ filter: ".item-box.sortable", container: g, hint: function (a) { return a.clone().addClass("hint") }, placeholder: function () { return '<div class="item-box sortable placeholder"><span>Drag and drop your product here</span></div>' }, change: function () { f.push(function () { var b = []; e.find(".products-grid.sortable-grid .item-box.sortable").each(function () { b.push(a(this).attr("data-productId")) }); var c = addAntiForgeryToken(); c.itemId = parseInt(e.find(".group-item-id").val()) || 0, c.productIds = b, f.isSaveToPop(!1), a.ajax({ url: d.attr("data-reorderProductsInCustomListUrl"), type: "POST", data: c }).fail(function () { }).always(function () { f.isSaveToPop(!0) }) }) } }) } }), a("#Store").on("change", function () { var b = a(this).val(); a(".searchStoreId").each(function () { var c = a(this); c.val(b), m(c) }) }), a(".products-vary-by-acl-message").each(function () { var b = a(this); b.closest(".tab-content").find(".products-grid .item-box").length > 0 && b.removeClass("hidden") }) }; a(document).ready(function () { o(), a(document).on("newProductGroupAddedEvent", o), h() }) }(jQuery);